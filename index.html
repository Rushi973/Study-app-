<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Auth Diagnostic</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body{font-family:system-ui;margin:20px;background:#fff7f1}
    button{background:#c0522a;color:#fff;border:0;border-radius:8px;padding:10px 14px;margin:6px 6px 6px 0}
    input{padding:10px;width:320px;display:block;margin:6px 0}
    pre{background:#fff;border:1px solid #eee;border-radius:8px;padding:10px;white-space:pre-wrap}
  </style>
</head>
<body>
  <h2>Supabase Auth Diagnostic</h2>

  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button id="signup" type="button">Sign up</button>
  <button id="signin" type="button">Sign in</button>
  <button id="rawTest" type="button">Raw Sign-In Test</button>

  <p id="authState">boot</p>
  <pre id="rawOut"></pre>

  <script>
    // ---- Supabase Auth (working) ----
const SB_URL  = "https://iwfesilevqjumoyfrpzt.supabase.co";
const SB_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml3ZmVzaWxldnFqdW1veWZycHp0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI1MTgwOTYsImV4cCI6MjA3ODA5NDA5Nn0.YMtYRdS6NoEkyZibCa0RWAspfs5uWd14gmBEfFFKAWQ";
const sb = window.supabase.createClient(SB_URL, SB_ANON);

const emailEl   = document.getElementById("email");
const passEl    = document.getElementById("password");
const signupBtn = document.getElementById("signup");
const signinBtn = document.getElementById("signin");
const authState = document.getElementById("authState");

function setAuth(m){ authState.textContent = m; }
async function showUser(){
  const { data, error } = await sb.auth.getUser();
  setAuth(error ? ("getUser error: " + error.message)
                : (data.user ? `Signed in: ${data.user.email}` : "Not signed in"));
}
sb.auth.onAuthStateChange(()=>showUser());

signupBtn.onclick = async () => {
  const email = (emailEl.value||"").trim();
  const password = passEl.value||"";
  if (!email || !password) return setAuth("Enter email and password");
  const { error } = await sb.auth.signUp({ email, password });
  setAuth(error ? "Sign up error: " + error.message : "Signed up. Now press Sign in.");
};

signinBtn.onclick = async () => {
  const email = (emailEl.value||"").trim();
  const password = passEl.value||"";
  if (!email || !password) return setAuth("Enter email and password");
  const { error } = await sb.auth.signInWithPassword({ email, password });
  setAuth(error ? "Sign in error: " + error.message : "Signed in.");
  if (!error) showUser();
};
showUser();

    // Raw HTTP test bypassing SDK
    document.getElementById("rawTest").onclick = async () => {
      rawOut.textContent = "Testingâ€¦";
      const email = (emailEl.value||"").trim();
      const password = passEl.value||"";
      try {
        const res = await fetch(`${SB_URL}/auth/v1/token?grant_type=password`, {
          method: "POST",
          headers: { "apikey": SB_ANON, "Content-Type": "application/json" },
          body: JSON.stringify({ email, password })
        });
        const text = await res.text();
        rawOut.textContent = `HTTP ${res.status}\n${text}`;
      } catch (e) {
        rawOut.textContent = `JS error: ${e.message}`;
      }
    };

    showUser();
  </script>
</body>
</html>
